pipeline {
    agent any
    
    stages {
        stage('Approval') {
            steps {
                script {
                    def userInput = input(id: 'Confirm', message: 'Apply Terraform?', parameters: [ [$class: 'BooleanParameterDefinition', defaultValue: false, description: 'Apply terraform', name: 'Confirm'] ])
                }
            }
        }
        stage('Obtener secreto del Vault') {
            steps {
                script {
                    // Define los secretos y las variables de entorno
                    def secrets = [
                        [path: 'secrets/creds/mongodb', engineVersion: 1, secretValues: [
                            [envVar: 'MONGO_USERNAME', vaultKey: 'MONGO_USERNAME'],
                            [envVar: 'MONGO_PASSWORD', vaultKey: 'MONGO_PASSWORD']
                        ]]
                    ]

                    // Configuraci칩n opcional, si no la proporcionas se usar치 la configuraci칩n global
                    def configuration = [vaultUrl: 'http://vault:8200',
                                         vaultCredentialId: 'vault-jenkins-role',
                                         engineVersion: 1]

                    // Dentro de este bloque tus credenciales estar치n disponibles como variables de entorno
                    withVault([configuration: configuration, vaultSecrets: secrets]) {
                        // Utiliza la variable de entorno para acceder al secreto
                        sh 'echo $MONGO_PASSWORD'
                    }
                }
            }
        }
    }
}
